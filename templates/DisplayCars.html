{% extends 'components/base.html'%}
{% load static %}
{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'css/display_car.css' %}">
{% endblock style %}
{% block content %}
<section>
    <div class="main-container">
        <div class="side-bar">
            <div class="booking-details">
                <h4>Booking Detail</h4>
                <p>From: {{ request.session.pickup_location }}</p>
                <p>To: {{ request.session.dropoff_location }}</p>
                <p>Start Date: {{ request.session.pickup_datetime }}</p>
                <p>End Date: {{ request.session.return_datetime }}</p>               
                <button class="edit-detail" onclick="openEditModal()">Edit Detail</button>
            </div>
            <div class="filters">
                <h1>Filters</h1>
                <div class="category-wrap">
                    <form id="filterForm" action="{% url 'display_car' %}" method="GET">
                        <div class="filter-category">
                            <h4>Transmission</h4>
                            <div class="filter-option">
                                <input type="radio" name="transmission" value="manual" id="manual">
                                <label for="manual"><img src="manual.png" alt="Manual Icon"> Manual</label>
                            </div>
                            <div class="filter-option">
                                <input type="radio" name="transmission" value="automatic" id="automatic">
                                <label for="automatic"><img src="automatic.png" alt="Automatic Icon"> Automatic</label>
                            </div>
                        </div>
                        <div class="filter-category">
                            <h4>Seats</h4>
                            <div class="filter-option">
                                <input type="radio" name="seats" value="4/5" id="seats4">
                                <label for="seats4">4/5 Seater</label>
                            </div>
                            <div class="filter-option">
                                <input type="radio" name="seats" value="6/10" id="seats6">
                                <label for="seats6">6/10 Seater</label>
                            </div>
                        </div>
                        <div class="filter-category">
                            <h4>Car type</h4>
                            <div class="filter-option">
                                <input type="radio" name="car_type" value="Hatchback" id="hatchback">
                                <label for="hatchback">Hatchback</label>
                            </div>
                            <div class="filter-option">
                                <input type="radio" name="car_type" value="Sedan" id="sedan">
                                <label for="sedan">Sedan</label>
                            </div>
                            <div class="filter-option">
                                <input type="radio" name="car_type" value="SUV" id="suv">
                                <label for="suv">SUV</label>
                            </div>
                            <div class="filter-option">
                                <input type="radio" name="car_type" value="MUV" id="muv">
                                <label for="muv">MUV</label>
                            </div>
                            <div class="filter-option">
                                <input type="radio" name="car_type" value="Mini Van" id="minivan">
                                <label for="minivan">Mini Van</label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% comment %} <div class="vehicle-container">
            {% if recommended_cars %}
            {% for vehicle in recommended_cars %}
            <div class="box">
                <div class="box-img">
                    <img src="{{ vehicle.image.url }}" alt="Vehicle">
                </div>
                <p>{{ vehicle.model_year }}</p>
                <h3>{{ vehicle.name }}</h3>
                <h2>{{ vehicle.price_per_day }}</span>/Day</h2>
                <a href="{% url 'View_car' vehicle.id %}" class="btn">View Details</a>
            </div>
            {% endfor %}
            {% endif %}
        </div>  {% endcomment %}
        <div class="vehicle-container">
            {% if vehicles %}
            {% for vehicle in vehicles %}
            <div class="box">
                <div class="box-img">
                    <img src="{{ vehicle.image.url }}" alt="Vehicle">
                </div>
                <p>{{ vehicle.model_year }}</p>
                <h3>{{ vehicle.name }}</h3>
                <h2>{{ vehicle.price_per_day }}</span>/Day</h2>
                <a href="{% url 'View_car' vehicle.id %}" class="btn">View Details</a>
            </div>
            {% endfor %}
            {% else %}
            <p>No vehicles available</p>
            {% endif %}
        </div>
        
    </div>
</section>


<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <form id="editForm" method="post" action="{% url 'edit_booking_detail' %}">
            {% csrf_token %}
            <div class="input-box">
                <label for="pickupLocation">Pick Up Location</label>
                <input type="text" id="pickupLocation" name="pickupLocation" value="{{ request.session.pickup_location }}" readonly>
            </div>
            <div class="input-box">
                <label for="dropOffLocation">Drop Off Location</label>
                <input type="text" id="dropOffLocation" name="dropOffLocation" value="{{ request.session.dropoff_location }}">
            </div>
            <div class="input-box">
                <label for="pickupDatetime">Pick-Up Date</label>
                <input type="datetime-local" id="pickupDatetime" name="pickupDatetime" value="{{ request.session.pickup_datetime }}">
            </div>
            <div class="input-box">
                <label for="returnDatetime">Return Date</label>
                <input type="datetime-local" id="returnDatetime" name="returnDatetime" value="{{ request.session.return_datetime }}">
            </div>
            <button type="submit" class="btn">Save</button>
        </form>
    </div>
</div>

<script>

    // Function to open the edit modal
function openEditModal() {
    var modal = document.getElementById('editModal');
    modal.style.display = "block";
}

// Function to close the edit modal
function closeEditModal() {
    var modal = document.getElementById('editModal');
    modal.style.display = "none";
}


    document.querySelectorAll('.filter-option input').forEach(function (input) {
        input.addEventListener('change', function () {
            document.getElementById('filterForm').submit();
        });
    });


    // Get the current date and time
    var today = new Date();
    
    // Format the date as required for datetime-local input
    var formattedDate = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);

    // Convert the hours to 12-hour format
    var hours = today.getHours();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // Handle midnight (12 AM)
    var formattedHours = ('0' + hours).slice(-2);

    // Format the time as required for datetime-local input
    var formattedTime = formattedHours + ':' + ('0' + today.getMinutes()).slice(-2);

    // Combine date and time
    var currentDateTime = formattedDate + 'T' + formattedTime;

    // Set the minimum value for pickupDatetime and returnDatetime inputs
    document.getElementById('pickupDatetime').min = currentDateTime;
    document.getElementById('returnDatetime').min = currentDateTime;
</script>
<script src="static/js/locations.js"></script>

{% endblock content %}